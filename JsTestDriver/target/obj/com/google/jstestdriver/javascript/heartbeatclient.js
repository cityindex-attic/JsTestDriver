jstestdriver.formatString=function(){var d=arguments.length;var a=[];var g=new RegExp("%[sdifo]","g");var e=0;while(e<d){var k=arguments[e];var h=g.exec(k);if(!h){var j=k;if(typeof j=="object"){j=JSON.stringify(j)}if(a.length>0){a.push(" ")}a.push(j);e++}else{var c=1;var b=e+1;var f=k;do{var j=arguments[b++];if(typeof j=="object"){j=JSON.stringify(j)}f=f.replace(h,j);c++}while((h=g.exec(f))!=null);a.push(f);e+=c}}return a.join("")};jstestdriver.convertToJson=function(a){return function(b,e,f){var d={};for(var c in e){d[c]=JSON.stringify(e[c])}a(b,d,f)}};jstestdriver.bind=function(a,b){return function(){return b.apply(a,arguments)}};jstestdriver.extractId=function(a){return a.match(/\/(slave|runner)\/(\d+)\//)[2]};jstestdriver.getBrowserFriendlyName=function(){if(jstestdriver.jQuery.browser.safari){if(navigator.userAgent.indexOf("Chrome")!=-1){return"Chrome"}return"Safari"}else{if(jstestdriver.jQuery.browser.opera){return"Opera"}else{if(jstestdriver.jQuery.browser.msie){return"Internet Explorer"}else{if(jstestdriver.jQuery.browser.mozilla){if(navigator.userAgent.indexOf("Firefox")!=-1){return"Firefox"}return"Mozilla"}}}}};jstestdriver.getBrowserFriendlyVersion=function(){if(jstestdriver.jQuery.browser.msie){if(typeof XDomainRequest!="undefined"){return"8.0"}}else{if(jstestdriver.jQuery.browser.safari){if(navigator.appVersion.indexOf("Chrome/")!=-1){return navigator.appVersion.match(/Chrome\/(.*)\s/)[1]}}}return jstestdriver.jQuery.browser.version};jstestdriver.toHtml=function(a,b){return jstestdriver.jQuery(a,b)[0]};jstestdriver.appendHtml=function(b,c){var a=jstestdriver.toHtml(b,c);jstestdriver.jQuery(c.body).append(a)};jstestdriver.Heartbeat=function(d,c,h,b,e,g,f,i,a){this.id_=d;this.url_=c;this.mode_=h;this.retries_=0;this.sendRequest_=b;this.interval_=e;this.boundHeartbeatCallback_=jstestdriver.bind(this,this.heartbeatCallback);this.boundSendHeartBeat_=jstestdriver.bind(this,this.sendHeartbeat);this.boundErrorCallback_=jstestdriver.bind(this,this.errorCallback);this.sent_=0;this.timeoutId_=-1;this.setTimeout_=g;this.getTime_=f;this.view_=i;this.navigateToPath_=a;this.capturePath_=jstestdriver.Heartbeat.CAPTURE_PATH+"?"+h};jstestdriver.Heartbeat.CAPTURE_PATH="/capture";jstestdriver.Heartbeat.RETRY_LIMIT=50;jstestdriver.Heartbeat.prototype.start=function(){this.view_.updateConnected(true);this.sendHeartbeat()};jstestdriver.Heartbeat.prototype.stop=function(){jstestdriver.clearTimeout(this.timeoutId_);this.view_.updateStatus("Dead.")};jstestdriver.Heartbeat.prototype.sendHeartbeat=function(){this.sent_=this.getTime_();this.sendRequest_(this.url_,{id:this.id_},this.boundHeartbeatCallback_,this.boundErrorCallback_)};jstestdriver.Heartbeat.prototype.errorCallback=function(){this.view_.updateConnected(false);if(this.retries_>jstestdriver.Heartbeat.RETRY_LIMIT){this.stop();return}this.retries_++;this.view_.updateStatus("Retrying "+this.retries_+" out of "+jstestdriver.Heartbeat.RETRY_LIMIT);this.timeoutId_=this.setTimeout_(this.boundSendHeartBeat_,this.interval_)};jstestdriver.Heartbeat.prototype.heartbeatCallback=function(b){if(b=="UNKNOWN"){this.navigateToPath_(this.capturePath_);return}var a=this.getTime_()-this.sent_;this.sent_=0;this.view_.updateStatus(b);if(a<this.interval_){this.timeoutId_=this.setTimeout_(this.boundSendHeartBeat_,this.interval_-a)}else{this.sendHeartbeat()}};jstestdriver.HeartbeatView=function(a,b){this.getBody_=a;this.createElement_=b;this.status_=null};jstestdriver.HeartbeatView.prototype.updateStatus=function(d){if(!this.status_){var b=this.getBody_();var a=b.ownerDocument;var c=b.appendChild(a.createElement("p"));c.innerHTML="JsTestDriver:<br/>";this.status_=c.appendChild(a.createElement("span"))}this.status_.innerHTML=d};jstestdriver.HeartbeatView.prototype.updateConnected=function(a){if(!a){this.getBody_().className=jstestdriver.HeartbeatView.ERROR_CLASS;this.updateStatus("Lost server...")}else{this.getBody_().className="";this.updateStatus("Waiting...")}};jstestdriver.HeartbeatView.ERROR_CLASS="error";