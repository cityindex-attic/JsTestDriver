jstestdriver.Heartbeat=function(d,c,h,b,e,g,f,i,a){this.id_=d;this.url_=c;this.mode_=h;this.retries_=0;this.sendRequest_=b;this.interval_=e;this.boundHeartbeatCallback_=jstestdriver.bind(this,this.heartbeatCallback);this.boundSendHeartBeat_=jstestdriver.bind(this,this.sendHeartbeat);this.boundErrorCallback_=jstestdriver.bind(this,this.errorCallback);this.sent_=0;this.timeoutId_=-1;this.setTimeout_=g;this.getTime_=f;this.view_=i;this.navigateToPath_=a;this.capturePath_=jstestdriver.Heartbeat.CAPTURE_PATH+"?"+h};jstestdriver.Heartbeat.CAPTURE_PATH="/capture";jstestdriver.Heartbeat.RETRY_LIMIT=50;jstestdriver.Heartbeat.prototype.start=function(){this.view_.updateConnected(true);this.sendHeartbeat()};jstestdriver.Heartbeat.prototype.stop=function(){jstestdriver.clearTimeout(this.timeoutId_);this.view_.updateStatus("Dead.")};jstestdriver.Heartbeat.prototype.sendHeartbeat=function(){this.sent_=this.getTime_();this.sendRequest_(this.url_,{id:this.id_},this.boundHeartbeatCallback_,this.boundErrorCallback_)};jstestdriver.Heartbeat.prototype.errorCallback=function(){this.view_.updateConnected(false);if(this.retries_>jstestdriver.Heartbeat.RETRY_LIMIT){this.stop();return}this.retries_++;this.view_.updateStatus("Retrying "+this.retries_+" out of "+jstestdriver.Heartbeat.RETRY_LIMIT);this.timeoutId_=this.setTimeout_(this.boundSendHeartBeat_,this.interval_)};jstestdriver.Heartbeat.prototype.heartbeatCallback=function(b){if(b=="UNKNOWN"){this.navigateToPath_(this.capturePath_);return}var a=this.getTime_()-this.sent_;this.sent_=0;this.view_.updateStatus(b);if(a<this.interval_){this.timeoutId_=this.setTimeout_(this.boundSendHeartBeat_,this.interval_-a)}else{this.sendHeartbeat()}};jstestdriver.HeartbeatView=function(a,b){this.getBody_=a;this.createElement_=b;this.status_=null};jstestdriver.HeartbeatView.prototype.updateStatus=function(d){if(!this.status_){var b=this.getBody_();var a=b.ownerDocument;var c=b.appendChild(a.createElement("p"));c.innerHTML="JsTestDriver:<br/>";this.status_=c.appendChild(a.createElement("span"))}this.status_.innerHTML=d};jstestdriver.HeartbeatView.prototype.updateConnected=function(a){if(!a){this.getBody_().className=jstestdriver.HeartbeatView.ERROR_CLASS;this.updateStatus("Lost server...")}else{this.getBody_().className="";this.updateStatus("Waiting...")}};jstestdriver.HeartbeatView.ERROR_CLASS="error";